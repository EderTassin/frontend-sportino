<div class="match-statistics-container">
  <header>
    <h1>Detalles Torneo</h1>
    <h3>{{tournament?.name}}</h3>
  </header>

  <section class="matches">
    <div class="d-flex justify-content-between">
      <h2>Resultados</h2>
      <div class="select">
        <mat-form-field appearance="fill">
          <mat-label>Fecha seleccionada</mat-label>
          <mat-select [(value)]="selectedDate" (selectionChange)="filterMatchesByDate()">
            <mat-option *ngFor="let item of datesSelects" [value]="item.date">{{item?.date}}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <ul>
      <div *ngIf="fixture && fixtureFilter?.length != 0">
        <li *ngFor="let match of fixtureFilter" class="match" (click)="openModal(match)">
          <div class="container-teams">
            <div class="team">
              <img [src]="environment + match.team_1.logo_file" alt="{{ match.homeTeam }} logo" class="team-logo" (error)="defaultImage($event)">
              <span class="team-name">{{ match.team_1?.name }}</span>
            </div>
            <div class="score">
              <div *ngIf="match.result">
                <span>{{ match.result?.goals_team_1 }}</span>
                <span>-</span>
                <span>{{ match.result?.goals_team_2 }}</span>
              </div>
              <div class="match-detail">
                <span>{{match.date}}</span>
              </div>
            </div>
            <div class="team">
              <span class="team-name">{{ match.team_2?.name }}</span>
              <img [src]="environment + match.team_2.logo_file" alt="{{ match.team_2?.name }} logo" class="team-logo" (error)="defaultImage($event)">
            </div>
          </div>
          
        </li>
      </div>
      <div *ngIf="!fixture && fixtureFilter?.length == 0">
        <h2>No existen registros</h2>
      </div>
    </ul>
  </section>

  <section>
    <h2 class="top-scorers__title">Goleadores</h2>
    <div class="top-scorers">
      <div class="top-scorers__list">
        <div *ngFor="let scorer of goleadores; let i = index" class="top-scorers__item">
          <div *ngIf="scorer.player_full_name">
            
            <span class="top-scorers__player">{{ i + 1 }}. {{ scorer.player_full_name }}</span>
          </div>
          <span *ngIf="scorer.player_full_name" class="top-scorers__goals">{{ scorer.goals }} goles</span>
        </div>
      </div>
    </div>
  </section>

  <section class="standings">
    <h2>Posiciones</h2>
    <div class="table-container">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th width="70px"></th>
            <th title="Nombre del equipo" matTooltip="Nombre del equipo">Equipos</th>
            <th title="Puntos acumulados" matTooltip="Puntos acumulados">Pts</th>
            <th title="Diferencia de goles" matTooltip="Diferencia de goles">DG</th>
            <th title="Goles a favor" matTooltip="Goles a favor">GF</th>
            <th title="Goles en contra" matTooltip="Goles en contra">GC</th>
            <th title="Partidos jugados" matTooltip="Partidos jugados">PJ</th>
            <th title="Partidos ganados" matTooltip="Partidos ganados">PG</th>
            <th title="Partidos empatados" matTooltip="Partidos empatados">PE</th>
            <th title="Partidos perdidos" matTooltip="Partidos perdidos">PP</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let team of listPosicion?.positions">
            <td>
              <img [src]="environment + team.logo" alt="{{ team.team }} logo" class="team-logo" (error)="defaultImage($event)">
            </td>
            <td><b>{{ team.team }}</b></td>
            <td>{{ team.points }}</td>
            <td>{{ team.goals_in_favor - team.goals_against }}</td> 
            <td>{{ team.goals_in_favor }}</td> 
            <td>{{ team.goals_against }}</td> 
            <td>{{ team.games.total }}</td>
            <td>{{ team.games.ganados }}</td>
            <td>{{ team.games.empatados }}</td>
            <td>{{ team.games.perdidos }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

<div class="modal" [ngClass]="{ 'open': showModal }">
  <div class="modal-content">
    <span class="close" (click)="closeModal()">&times;</span>
    <div class="match-details">
      <div class="team-details">
        <div class="team-detail">
          <img [src]="selectedMatch?.homeLogo" alt="{{ selectedMatch?.team_1.name }} logo" class="team-logo" (error)="defaultImage($event)">
          <span>{{ selectedMatch?.team_1.name }}</span>
        </div>
        <div class="team-result">
          <span>{{ selectedMatch?.result?.goals_team_1 }}</span>
          <span>-</span>
          <span>{{ selectedMatch?.result?.goals_team_2 }}</span>
        </div>
        <div class="team-detail">
          <span>{{ selectedMatch?.team_2.name }}</span>
          <img [src]="selectedMatch?.awayLogo" alt="{{ selectedMatch?.team_2.name }} logo" class="team-logo" (error)="defaultImage($event)">
        </div>
      </div>
      <div class="modal-tabs">
        <div class="modal-tab" (click)="selectTab('team1')" [ngClass]="{ 'active': activeTab === 'team1' }">
          {{ selectedMatch?.team_1.name }}
        </div>
        <div class="modal-tab" (click)="selectTab('team2')" [ngClass]="{ 'active': activeTab === 'team2' }">
          {{ selectedMatch?.team_2.name}}
        </div>
      </div>
      <div class="modal-body">
        <div *ngIf="activeTab === 'team1'">
          <h3>{{ selectedMatch?.team_1.name  }}</h3>
          <div>
            <div *ngFor="let player of selectedMatch?.team_1.players" class="item-player">
              <span>{{ player.full_name | camelcase}}</span>
              <div *ngIf="player.goals" class="action">
                <span *ngFor="let _ of createArray(player.goals[0].goal_number)" class="material-symbols-outlined">
                  sports_soccer
                </span>
              </div>
              <div *ngIf="player.cards > 0" class="action" [style.color]="player.cardColor">
                <span *ngFor="let _ of createArray(player.cards)" class="material-symbols-outlined">
                  square
                </span>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="activeTab === 'team2'">
          <h3>{{ selectedMatch?.team_2.name  }}</h3>
          <div>
            <div *ngFor="let player of selectedMatch?.team_2.players" class="item-player">
              <span>{{ player.full_name | camelcase}}</span>
              <div *ngIf="player.goals" class="action">
                <span *ngFor="let _ of createArray(player.goals[0].goal_number)" class="material-symbols-outlined">
                  sports_soccer
                </span>
              </div>
              <div *ngIf="player.cards > 0" class="action" [style.color]="player.cardColor">
                <span *ngFor="let _ of createArray(player.cards)" class="material-symbols-outlined">
                  square
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
