<div class="container mx-auto px-4 py-8">
  <!-- Back button -->
  <div class="p-4">
    <button (click)="goBack()" class="flex items-center gap-2 px-4 py-2 text-white bg-gray-600 rounded-lg shadow transition hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500">
      <mat-icon>arrow_back</mat-icon>
      <span>Volver</span>
    </button>
  </div>

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Gestionar Sanciones</h1>
    <button 
      (click)="openCreateForm()" 
      color="secondary"
      mat-raised-button
      *ngIf="!showForm"
      class="flex items-center">
      <mat-icon>add</mat-icon>
      Nueva Sanción
    </button>
  </div>

  <!-- Alert for errors -->
  <div *ngIf="error" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
    <p>{{ error }}</p>
  </div>

  <!-- Filters -->
  <mat-card class="mb-6" *ngIf="!showForm">
    <mat-card-content>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-4">
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Torneo</mat-label>
          <mat-select [(ngModel)]="selectedTournament">
            <mat-option [value]="null">Todos</mat-option>
            <mat-option *ngFor="let tournament of tournaments" [value]="tournament.id">
              {{ tournament.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Categoría</mat-label>
          <mat-select [(ngModel)]="selectedCategory">
            <mat-option [value]="null">Todas</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Equipo</mat-label>
          <mat-select [(ngModel)]="selectedTeam">
            <mat-option [value]="null">Todos</mat-option>
            <mat-option *ngFor="let team of teams" [value]="team.id">
              {{ team.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="flex justify-end space-x-3 p-4">
        <button 
          mat-stroked-button
          (click)="resetFilters()">
          Resetear
        </button>
        <button 
          mat-raised-button
          color="primary"
          (click)="applyFilters()">
          Aplicar Filtros
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Sanction Form -->
  <mat-card *ngIf="showForm" class="mb-8">
    <mat-card-header>
      <mat-card-title>{{ isEditMode ? 'Editar' : 'Crear' }} Sanción</mat-card-title>
    </mat-card-header>
    
    <mat-card-content class="p-4">
      <form [formGroup]="sanctionForm" (ngSubmit)="saveSanction()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Sanction For -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Tipo de Sanción</mat-label>
            <mat-select formControlName="sanction_for">
              <mat-option value="P">Jugador</mat-option>
              <mat-option value="T">Equipo</mat-option>
              <mat-option value="C">Entrenador</mat-option>
            </mat-select>
            <mat-error *ngIf="sanctionForm.get('sanction_for')?.invalid">Campo requerido</mat-error>
          </mat-form-field>

          <!-- Reason -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Razón</mat-label>
            <input matInput formControlName="reason">
            <mat-error *ngIf="sanctionForm.get('reason')?.invalid">Campo requerido</mat-error>
          </mat-form-field>

          <!-- Missed Dates -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Fechas Perdidas</mat-label>
            <input matInput type="number" formControlName="missed_dates" min="0">
            <mat-error *ngIf="sanctionForm.get('missed_dates')?.invalid">Campo requerido</mat-error>
          </mat-form-field>

          <!-- Yellow Cards -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Tarjetas Amarillas</mat-label>
            <input matInput formControlName="yellow_cards">
          </mat-form-field>

          <!-- Red Card -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Tarjeta Roja</mat-label>
            <input matInput formControlName="red_card">
          </mat-form-field>

          <!-- Game -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Partido</mat-label>
            <input matInput type="number" formControlName="game" min="0">
            <mat-error *ngIf="sanctionForm.get('game')?.invalid">Campo requerido</mat-error>
          </mat-form-field>

          <!-- Player -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Jugador</mat-label>
            <input matInput type="number" formControlName="player" min="0">
            <mat-error *ngIf="sanctionForm.get('player')?.invalid">Campo requerido</mat-error>
          </mat-form-field>
        </div>

        <div class="mt-6 flex justify-end space-x-3">
          <button 
            type="button" 
            mat-stroked-button
            (click)="cancelForm()">
            Cancelar
          </button>
          <button 
            type="submit" 
            mat-raised-button
            color="primary"
            [disabled]="sanctionForm.invalid || loading">
            {{ isEditMode ? 'Actualizar' : 'Crear' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Sanctions Table -->
  <div *ngIf="!loading && !showForm" class="bg-white shadow-md rounded-lg overflow-hidden">
    <div *ngIf="sanctions.length === 0" class="p-6 text-center text-gray-500">
      No se encontraron sanciones. ¡Crea la primera!
    </div>
    
    <div *ngIf="sanctions.length > 0" class="overflow-x-auto">
      <table mat-table [dataSource]="sanctions" class="min-w-full">
        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let sanction">{{ sanction.id }}</td>
        </ng-container>

        <!-- Sanction For Column -->
        <ng-container matColumnDef="sanction_for">
          <th mat-header-cell *matHeaderCellDef>Tipo</th>
          <td mat-cell *matCellDef="let sanction">{{ getSanctionForLabel(sanction.sanction_for) }}</td>
        </ng-container>

        <!-- Reason Column -->
        <ng-container matColumnDef="reason">
          <th mat-header-cell *matHeaderCellDef>Razón</th>
          <td mat-cell *matCellDef="let sanction">{{ sanction.reason }}</td>
        </ng-container>

        <!-- Missed Dates Column -->
        <ng-container matColumnDef="missed_dates">
          <th mat-header-cell *matHeaderCellDef>Fechas Perdidas</th>
          <td mat-cell *matCellDef="let sanction">{{ sanction.missed_dates }}</td>
        </ng-container>

        <!-- Yellow Cards Column -->
        <ng-container matColumnDef="yellow_cards">
          <th mat-header-cell *matHeaderCellDef>Tarjetas Amarillas</th>
          <td mat-cell *matCellDef="let sanction">{{ sanction.yellow_cards }}</td>
        </ng-container>

        <!-- Red Card Column -->
        <ng-container matColumnDef="red_card">
          <th mat-header-cell *matHeaderCellDef>Tarjeta Roja</th>
          <td mat-cell *matCellDef="let sanction">{{ sanction.red_card }}</td>
        </ng-container>

        <!-- Game Column -->
        <ng-container matColumnDef="game">
          <th mat-header-cell *matHeaderCellDef>Partido</th>
          <td mat-cell *matCellDef="let sanction">{{ sanction.game?.date }}</td>
        </ng-container>

        <!-- Player Column -->
        <ng-container matColumnDef="player">
          <th mat-header-cell *matHeaderCellDef>Jugador</th>
          <td mat-cell *matCellDef="let sanction">{{ sanction?.player?.full_name }}</td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="text-right">Acciones</th>
          <td mat-cell *matCellDef="let sanction" class="text-right">
            <button 
              mat-icon-button 
              color="primary"
              matTooltip="Editar"
              (click)="openEditForm(sanction)">
              <mat-icon>edit</mat-icon>
            </button>
            <button 
              mat-icon-button 
              color="warn"
              matTooltip="Eliminar"
              (click)="deleteSanction(sanction.id!)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50"></tr>
      </table>
    </div>
  </div>
</div>
